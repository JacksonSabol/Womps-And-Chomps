// https://www.residentadvisor.net/images/events/flyer/2019/8/us-0822-1301172-front.jpg

const getResAdvisorImage = require("./link-splitting").getResAdvisorImage;
const splitUrl = require("./link-splitting").splitUrl;
const raUrl = "https://www.residentadvisor.net/events/1301172";

async function testShit(url) {
    try {
        const result = {};
        console.log(splitUrl(url));
        if (splitUrl(url) === "residentadvisor") {
            const source = await getResAdvisorImage(url);
            if (source === "Check") {
                console.log("Fix query selector");
            } else {
                result.imgSrc = source;
            }
        } else {
            console.log("Failed");
        }
        console.log(result);
    } catch (e) { console.log(e); }
}

// testShit(raUrl);

// Test for multiple entries

const testData = [{
    notes: [],
    dateAndTime: 'Wed: Aug 21 (9pm-2am)',
    title: 'Housepitality: DJ Three, Cole, Dax Lee',
    fullTitle: 'Housepitality: DJ Three, Cole, Dax Lee @ F8 1192 Folsom (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1298839',
    tags: 'funky house, deep house',
    priceAndAges: 'Free w/RSVP b4 10pm / $5 pre / $10 | 21+',
    organizers: 'Housepitality',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/2371720199541455/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Thu: Aug 22 (10pm-1:55am)',
    title: 'Konstruct w/ Pinion, Tariq and U-Srd',
    fullTitle: 'Konstruct w/ Pinion, Tariq and U-Srd @ Underground (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1301172',
    tags: 'techno',
    priceAndAges: '$10 | 21+',
    organizers: 'Konstruct',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/2674615709215778/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Aug 23 (9:30pm-3:30am)',
    title: 'Seb Wildblood, Wonja, Onemohit b2b Camdaze',
    fullTitle: 'Seb Wildblood, Wonja, Onemohit b2b Camdaze @ Public Works (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1296032',
    tags: 'house, funk, deep house',
    priceAndAges: '$16 | 21+',
    organizers: 'Make It Funky, Brouhaha',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/457640254786310/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Aug 24 (5pm-11:30pm)',
    title: 'Yuka Yu',
    fullTitle: 'Yuka Yu @ Fern Bar (6780 Depot Street, Suite 120, Sebastopol)',
    link: 'http://www.residentadvisor.net/events/1303353',
    tags: 'dubstep, world music',
    priceAndAges: 'Free | 21+',
    organizers: '',
    externalLinkTitle: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sun: Aug 25 (12pm-9pm)',
    title: 'Sunset Sound System Summer Boat Party Pre-Party w/Superfreq, Mr. C, Dance Spirit, Galen , David Scuba',
    fullTitle: 'Sunset Sound System Summer Boat Party Pre-Party w/Superfreq, Mr. C, Dance Spirit, Galen , David Scuba @ The Midway (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1298248',
    tags: 'tech house, deep house, funky house',
    priceAndAges: '$15 | 21+',
    organizers: 'Permission to Land, Superfreq',
    externalLinkTitle: 'Event Link',
    externalLink: 'https://www.bigneon.com/events/permission-to-land-x-sunset-sound-system-superfreq-more',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sun: Aug 25 (5pm-11pm)',
    title: 'Sunset Sound System Summer Boat Party: Mike Servito, Galen, Johnnie Walker, Supervixen',
    fullTitle: 'Sunset Sound System Summer Boat Party: Mike Servito, Galen, Johnnie Walker, Supervixen @ The San Francisco Spirit (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1242259',
    tags: 'house, disco, deep house, funk',
    priceAndAges: '$60-65 | 21+',
    organizers: 'Sunset Sound System',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/896145394079478/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Wed: Aug 28 (9pm-2am)',
    title: 'Housepitality: Residents Night! Davi A, Rodney, One A, Sharon, Victor, Joel, Tyrel',
    fullTitle: 'Housepitality: Residents Night! Davi A, Rodney, One A, Sharon, Victor, Joel, Tyrel @ F8 1192 Folsom (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1303755',
    tags: 'deep house, tech house, funky house',
    priceAndAges: 'Free w/RSVP b4 10pm / $5 pre / $10 | 21+',
    organizers: 'Housepitality',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/1094806617379844/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Wed: Aug 28 (9:30pm-2:30am)',
    title: 'Smokin Beats w/ DJ Umami',
    fullTitle: 'Smokin Beats w/ DJ Umami @ Monarch (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1303896',
    tags: 'hip-hop, moombahton, club music',
    priceAndAges: '$10 | 21+',
    organizers: 'Monarch SF',
    externalLinkTitle: 'Event Link',
    externalLink: 'https://www.eventbrite.com/e/smokin-beats-with-dj-umami-tickets-68902642659',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Thu: Aug 29 (9pm-2am)',
    title: 'Supernature Thursdays: The Unusual Suspects w/Miguel Alvarado, Shiva T, Brent Northey , Becca Hogue',
    fullTitle: 'Supernature Thursdays: The Unusual Suspects w/Miguel Alvarado, Shiva T, Brent Northey , Becca Hogue @ Monarch (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1298279',
    tags: 'tech house, deep house',
    priceAndAges: '$5 | 21+',
    organizers: 'Monarch SF',
    externalLinkTitle: 'Event Link',
    externalLink: 'https://www.eventbrite.com/e/supernature-thursdays-the-unusual-suspects-tickets-66974026115',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Aug 30 (10pm-2am)',
    title: 'Joel Conway',
    fullTitle: 'Joel Conway @ Phonobar (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1302008',
    tags: 'deep house, techno, disco',
    priceAndAges: 'Free | 21+',
    organizers: 'Phonobar',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/2276851945714194/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Aug 31 (9:30pm-4am)',
    title: 'As You Like It w/ Levon Vincent, Jordan Poling (Hybrid Set), Tyrel Williams, DJ Patrick, illa',
    fullTitle: 'As You Like It w/ Levon Vincent, Jordan Poling (Hybrid Set), Tyrel Williams, DJ Patrick, illa @ Monarch (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1283030',
    tags: 'house, techno, deep house',
    priceAndAges: '$15-20 | 21+',
    organizers: 'As You Like It',
    externalLinkTitle: 'Event Link',
    externalLink: 'http://www.ayli-sf.com',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sun: Sep 1 (9pm-4am)',
    title: 'Honey Soundsystem Labor Day 2019: Dorisburg, Alex Falk, Von Gold, Wonja, Honey Soundsystem',
    fullTitle: 'Honey Soundsystem Labor Day 2019: Dorisburg, Alex Falk, Von Gold, Wonja, Honey Soundsystem @ Audio (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1234841',
    tags: 'house, deep house, tech house',
    priceAndAges: '$15-20 | 21+',
    organizers: 'Honey Soundsystem',
    externalLinkTitle: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Wed: Sep 4 (9pm-2am)',
    title: 'Vladimir Ivkovic, Solar, Matthew Paul, Jordee',
    fullTitle: 'Vladimir Ivkovic, Solar, Matthew Paul, Jordee @ The Stud (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1300505',
    tags: 'house',
    priceAndAges: '$5-10 | 21+',
    organizers: 'Kosmetik, We Are Monsters:',
    externalLinkTitle: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Thu: Sep 5 (10pm-3am)',
    title: 'Francis Harris',
    fullTitle: 'Francis Harris @ Phonobar (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1302015',
    tags: 'ambient, techno',
    priceAndAges: '$7-10 | 21+',
    organizers: 'Phonobar',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/2311551782233385/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Sep 6 (9pm-2am)',
    title: 'Flying Circus: Audiofly, Sabo',
    fullTitle: 'Flying Circus: Audiofly, Sabo @ The Midway (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1297080',
    tags: 'tech house',
    priceAndAges: '$20-35 | 21+',
    organizers: 'The Midway',
    externalLinkTitle: 'Event Link',
    externalLink: 'https://www.bigneon.com/events/flying-circus-audiofly-sabo-more-tba',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Sep 6 (9pm-4am)',
    title: 'Direct To Earth w/ Dimi Angelis, Insolate & More Tba',
    fullTitle: 'Direct To Earth w/ Dimi Angelis, Insolate & More Tba @ F8 1192 Folsom (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1293841',
    tags: 'techno',
    priceAndAges: '$10-15 | 21+',
    organizers: 'Direct To Earth',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/491930021576310/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Sep 6 (9pm-4am)',
    title: 'Einzelkind',
    fullTitle: 'Einzelkind @ TBA (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1289855',
    tags: 'minimal, tech house, techno',
    priceAndAges: '',
    organizers: '',
    externalLinkTitle: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Sep 7 (2pm-9pm)',
    title: 'An Intimate Day Party w/ Perfect Stranger, Yuli Fershtat, Earthling',
    fullTitle: 'An Intimate Day Party w/ Perfect Stranger, Yuli Fershtat, Earthling @ The Midway (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1297085',
    tags: 'psytrance',
    priceAndAges: '$15-22 | 21+',
    organizers: 'The Midway',
    externalLinkTitle: 'Event Link',
    externalLink: 'https://www.bigneon.com/events/an-intimate-day-party-with-perfect-stranger/tickets',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Sep 7 (9pm-2am)',
    title: 'Cashu, Sis Girl, Eugenia',
    fullTitle: 'Cashu, Sis Girl, Eugenia @ Underground (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1299441',
    tags: 'deep house, techno',
    priceAndAges: '$5-10 | 21+',
    organizers: 'Undefined & Noctuary',
    externalLinkTitle: 'Event Link',
    externalLink: 'http://www.noctuarysf.com',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Sep 7 (9:30pm-3:30am)',
    title: 'Max Cooper (Live A/V) + Geju & Betelgeize - Leveldva',
    fullTitle: 'Max Cooper (Live A/V) + Geju & Betelgeize - Leveldva @ Public Works Loft (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1290644',
    tags: 'techno',
    priceAndAges: '$20 | 21+',
    organizers: '',
    externalLinkTitle: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sun: Sep 8 (1pm-9pm)',
    title: 'KMLN (Live), Britta Unders',
    fullTitle: 'KMLN (Live), Britta Unders @ The Midway (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1281329',
    tags: 'deep house',
    priceAndAges: '$20-24 | 21+',
    organizers: 'On&On, Below Radar',
    externalLinkTitle: 'Event Link',
    externalLink: 'http://ononsf.com',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Sep 13 (9pm-4am)',
    title: 'Robot Ears: Dax J',
    fullTitle: 'Robot Ears: Dax J @ F8 1192 Folsom (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1297038',
    tags: 'techno',
    priceAndAges: '$15-20 | 21+',
    organizers: 'Robot Ears',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/2066328500339083/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Sep 14 (3pm-8pm)',
    title: 'Fantastic Voyage Vol. 5',
    fullTitle: 'Fantastic Voyage Vol. 5 @ Pier 3 (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1281120',
    tags: 'house, disco',
    priceAndAges: '$45-60 | 21+',
    organizers: 'Make It Funky & Frolick',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/685307651910556/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Sep 21 (6pm-10pm)',
    title: 'Anchorz Up Boat Party w/ Coyu, NiQW, Devon James, RIFFA, Willaa, IceCreams, MICHI+, Anthony Zmoda',
    fullTitle: 'Anchorz Up Boat Party w/ Coyu, NiQW, Devon James, RIFFA, Willaa, IceCreams, MICHI+, Anthony Zmoda @ Hornblower Spirit (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1301210',
    tags: 'tech house',
    priceAndAges: '$65-75 | 21+',
    organizers: '#Pinkezup',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/362577987758808/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Sep 28 (2pm-10pm)',
    title: 'Black Book Block Party - Chris Lake, NOIZU, Yolanda Be Cool',
    fullTitle: 'Black Book Block Party - Chris Lake, NOIZU, Yolanda Be Cool @ The Midway (San Francisco)',
    link: 'http://www.residentadvisor.net/events/1298244',
    tags: 'tech house, g-house, funky house',
    priceAndAges: '$30-50 | 21+',
    organizers: 'The Midway',
    externalLinkTitle: 'Event Link',
    externalLink: 'https://www.bigneon.com/events/chris-lake-block-party-at-the-midway/tickets',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Sep 28 (9pm-4am)',
    title: 'Ghostly 20 San Francisco w/ Audion, Gold Panda, Shigeto, Lusine, Telefon Tel Aviv, Galcher Lustwerk (DJ), Russell EL Butler (DJ), Khotin (DJ)',
    fullTitle: 'Ghostly 20 San Francisco w/ Audion, Gold Panda, Shigeto, Lusine, Telefon Tel Aviv, Galcher Lustwerk (DJ), Russell EL Butler (DJ), Khotin (DJ) @ The Midway (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1292235',
    tags: 'techno, experimental, deep house',
    priceAndAges: '$27.50-37.50 | 21+',
    organizers: 'Ghostly International, Decibel Festival',
    externalLinkTitle: 'Event Link',
    externalLink: 'https://www.bigneon.com/events/ghostly-20-san-francisco/tickets',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sun: Sep 29 (4pm-4am)',
    title: 'Honey Soundsystem\'s House Of Black Leather 2019',
    fullTitle: 'Honey Soundsystem\'s House Of Black Leather 2019 @ Audio (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1234854',
    tags: 'house, deep house',
    priceAndAges: '$20-30 | 21+',
    organizers: 'Honey Soundsystem',
    externalLinkTitle: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Oct 4 (9pm-4am)',
    title: '8 Years Of Direct To Earth',
    fullTitle: '8 Years Of Direct To Earth @ F8 1192 Folsom (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1293843',
    tags: 'techno',
    priceAndAges: '$10-15 | 21+',
    organizers: 'Direct To Earth',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'https://www.facebook.com/events/329665021246340/',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Oct 4 (9:30pm-3am)',
    title: 'Fleetmac Wood Presents Sea Of Love Disco w/Roxanne Roll, Smooth Sailing',
    fullTitle: 'Fleetmac Wood Presents Sea Of Love Disco w/Roxanne Roll, Smooth Sailing @ The Midway (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1273959',
    tags: 'disco, house, mashups',
    priceAndAges: '$20-25 | 21+',
    organizers: 'The Midway, Fleetmac Wood',
    externalLinkTitle: 'Event Link',
    externalLink: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Fri: Oct 4 (10pm-3am)',
    title: 'The Ghost & Gene On Earth - Coast 2 Coast',
    fullTitle: 'The Ghost & Gene On Earth - Coast 2 Coast @ Phonobar (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1298808',
    tags: 'tech house, breaks',
    priceAndAges: '21+',
    organizers: 'Phonobar',
    externalLinkTitle: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Mon: Nov 4 (8pm-12:30am)',
    title: 'Visions Of A New World X Left Hand Path: HTRK (live)',
    fullTitle:
        'Visions Of A New World X Left Hand Path: HTRK (live) @ Underground (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1301104',
    tags: 'techno, leftfield, experimental',
    priceAndAges: '$15-19.50 | 21+',
    organizers: 'Left Hand Path',
    externalLinkTitle: '',
    imgSrc: '',
},
{
    notes: [],
    dateAndTime: 'Sat: Nov 9 (9pm-2am)',
    title:
        'Deep Sugar Sweet16 Anniv. Tour & David Harness Bday w/Ultra Nate, Lisa Moody',
    fullTitle:
        'Deep Sugar Sweet16 Anniv. Tour & David Harness Bday w/Ultra Nate, Lisa Moody @ The Midway (San Francisco)',
    link: 'https://www.residentadvisor.net/events/1300512',
    tags: 'deep house',
    priceAndAges: 'Free | 21+',
    organizers: '',
    externalLinkTitle: 'Facebook Page',
    externalLink: 'http://www.facebook.com/events/1996296547138024/',
    imgSrc: '',
}];

const n = testData.length;

async function* pollGen() {
    let i = 0;
    while (i < n)
        yield new Promise((resolve, reject) => {
            setTimeout(async () => {
                const tempSource = await getResAdvisorImage(testData[i].link);
                const source = tempSource.error ? tempSource.error : tempSource;
                i++
                resolve(source)
            }, 4000);
        });
}

(async function main() {
    let i = 0;
    for await (const result of pollGen()) {
        console.log(i);
        testData[i].imgSrc = result;
        i++
    }
    console.log(testData);
}());

